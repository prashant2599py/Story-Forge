{"code":"(()=>{\n\"use strict\";var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var blog_exports={};__export(blog_exports,{blogRouter:()=>blogRouter});module.exports=__toCommonJS(blog_exports);var import_edge=require(\"@prisma/client/edge\");var import_extension_accelerate=require(\"@prisma/extension-accelerate\");var import_hono=require(\"hono\");var import_jwt=require(\"hono/jwt\");var import_medium_common=require(\"@plodhi/medium-common\");const blogRouter=new import_hono.Hono;blogRouter.options(\"/*\",c=>{c.header(\"Access-Control-Allow-Origin\",\"http://localhost:5173\");c.header(\"Access-Control-Allow-Credentials\",\"true\");c.header(\"Access-Control-Allow-Methods\",\"GET,POST,PUT,DELETE,OPTIONS\");c.header(\"Access-Control-Allow-Headers\",\"Content-Type,Authorization\");return c.text(\"\",204)});const prisma=new import_edge.PrismaClient().$extends((0,import_extension_accelerate.withAccelerate)());blogRouter.use(\"/*\",async(c,next)=>{const authHeader=c.req.header(\"authorization\")||\"\";const user=await(0,import_jwt.verify)(authHeader,c.env.JWT_SECRET);try{if(user){c.set(\"userId\",user.id);await next()}else{c.status(403);return c.json({message:\"You are not logged In\"})}}catch(e){c.status(403);return c.json({message:\"You are not logged in\"})}});blogRouter.post(\"/\",async c=>{const body=await c.req.json();const{success}=import_medium_common.createBlogInput.safeParse(body);if(!success){c.status(411);return c.json({message:\"Inputs are not correct\"})}const authorId=c.get(\"userId\");const blog=await prisma.blog.create({data:{title:body.title,content:body.content,authorId:Number(authorId)}});return c.json({id:blog.id})});blogRouter.put(\"/\",async c=>{const body=await c.req.json();const{success}=import_medium_common.updateBlogInput.safeParse(body);if(!success){c.status(411);return c.json({message:\"Inputs are not correct\"})}const blog=await prisma.blog.update({where:{id:body.id},data:{title:body.title,content:body.content}});return c.json({id:blog.id})});blogRouter.get(\"/bulk\",async c=>{c.header(\"Access-Control-Allow-Origin\",\"http://localhost:5173\");const blogs=await prisma.blog.findMany({select:{content:true,title:true,id:true,createdAt:true,author:{select:{name:true}}}});return c.json({blogs})});blogRouter.get(\"/:id\",async c=>{const id=c.req.param(\"id\");try{const blog=await prisma.blog.findFirst({where:{id:Number(id)},select:{id:true,title:true,content:true,createdAt:true,author:{select:{name:true}}}});return c.json({blog})}catch(e){c.status(411);return c.json({message:\"Error while fetching the post\"})}});0&&(module.exports={blogRouter});\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["D:\\experimentation\\medium\\backend-aws\\routes\\blog.ts"],"sourcesContent":[null]}}